---
- name: Set fact for Glusterfs Primary node
  set_fact:
    gluster_leader: "{{ groups[target+'_glusterfs_nodes'][0] }}"

- name: Set fact for Glusterfs agents
  set_fact:
    gluster_nodes: "{{ groups[target+'_glusterfs_nodes'][1:] }}"

- name: Install GlusterFS server and Zabbix agent
  apt:
    name:
      - glusterfs-server
      - zabbix-agent
    state: present

- name: Create volume
  gluster_volume: 
    state: present
    name: "{{ volume_name }}"
    bricks: "{{storage_directory}}/{{glusterfs_storage}}/brick"
    replicas: "{{ groups[target + '_glusterfs_nodes'] | count }}"
    cluster: "{{ groups[target + '_glusterfs_nodes'] }}"
